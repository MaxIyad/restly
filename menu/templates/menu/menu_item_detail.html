<!-- menu_list.html -->


<h1>{{ menu_item.name }}</h1>
<p><strong>Category:</strong> {{ category.name }}</p>

<!-- Add recipe ingredient -->
<form method="post">
    {% csrf_token %}
    <label for="id_ingredient_name">Ingredient</label>
    <select id="id_ingredient_name" name="ingredient_name" class="form-control">
        <option value="">Select an ingredient</option>
        {% for name in recipe_ingredient_form.fields.ingredient_name.choices %}
            <option value="{{ name.0 }}">{{ name.1 }}</option>
        {% endfor %}
    </select>

    <label for="id_category">Category</label>
    <select id="id_category" name="category" class="form-control">
        <option value="">Select a category</option>
    </select>

    <label for="id_quantity">Quantity</label>
    <input type="number" id="id_quantity" name="quantity" class="form-control" step="0.01">

    <button type="submit" name="add_ingredient" class="btn btn-primary">Add Ingredient</button>
</form>



<!-- List recipe ingredients -->
<table>
    <thead>
        <tr>
            <th>Ingredient</th>
            <th>Quantity</th>
            <th>Unit</th>
            <th>Deplete From</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for recipe_ingredient in recipe_ingredients %}
        <tr>
            <td>{{ recipe_ingredient.ingredient.name }}</td>
            <td>{{ recipe_ingredient.quantity }}</td>
            <td>{{ recipe_ingredient.ingredient.unit_multiplier }}{{ recipe_ingredient.ingredient.unit_type }}</td>
            <td>{{ recipe_ingredient.category.name }}</td>
            <td>
                <!-- Remove Ingredient Button -->
                <form method="post" style="display:inline;">
                    {% csrf_token %}
                    <input type="hidden" name="ingredient_id" value="{{ recipe_ingredient.id }}">
                    <button type="submit" name="remove_ingredient" class="btn btn-danger btn-sm">Remove</button>
                </form>
            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="5">No ingredients added to this recipe.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<script>

    document.addEventListener("DOMContentLoaded", function () {
        const ingredientSelect = document.querySelector("#id_ingredient_name");
        const categorySelect = document.querySelector("#id_category");

        ingredientSelect.addEventListener("change", function () {
            const ingredientName = this.value;

            // Clear existing options in the category dropdown
            categorySelect.innerHTML = '<option value="">Select a category</option>';

            if (ingredientName) {
                fetch(`/get-categories-for-ingredient/?ingredient_name=${ingredientName}`)
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.categories && data.categories.length > 0) {
                            data.categories.forEach(category => {
                                const option = document.createElement("option");
                                option.value = category.id;
                                option.textContent = category.name;
                                categorySelect.appendChild(option);
                            });
                        } else {
                            console.log("No categories found for the selected ingredient.");
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching categories:", error);
                    });
            }
        });
    });


</script>
