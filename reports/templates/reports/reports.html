{% extends "base.html" %}

{% block title %}
    Detailed Reports
{% endblock %}

{% block content %}
<div class="container my-4">
    <h1>Detailed Ingredient Reports</h1>

    <!-- Section: Summary of Ingredients -->
    <h3>Summary of Ingredients in Active Menus</h3>
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Ingredient</th>
                <th>Unit</th>
                <th>Total Quantity Needed</th>
                <th>Current Inventory</th>
                <th>Categories</th>
                <th>Average Revenue per Unit ($)</th>
            </tr>
        </thead>
        <tbody>
            {% for ingredient in required_ingredients %}
            <tr>
                <td>{{ ingredient.name }}</td>
                <td>{{ ingredient.unit_type }}</td>
                <td>{{ ingredient.total_quantity|floatformat:2 }}</td>
                <td>{{ ingredient.current_quantity|floatformat:2 }}</td>
                <td>{{ ingredient.categories }}</td>
                <td>${{ ingredient.average_revenue_per_unit|floatformat:2 }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <!-- Section: Revenue Estimation -->
    <h3 class="mt-5">Revenue Estimation</h3>
    <form method="POST">
        {% csrf_token %}
        <input type="hidden" name="mode" value="ingredients_to_revenue">
        <div class="mb-3">
            <label for="ingredient_revenue_goal" class="form-label">Enter Ingredient Quantities:</label>
        </div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Ingredient</th>
                    <th>Quantity</th>
                    <th>Unit</th>
                </tr>
            </thead>
            <tbody>
                {% for ingredient in required_ingredients %}
                <tr>
                    <td>{{ ingredient.name }}</td>
                    <td>
                        <input type="number" class="form-control" id="quantity_{{ ingredient.id }}"
                               name="quantity_{{ ingredient.id }}" step="0.01" value="{{ ingredient.current_quantity }}">
                    </td>
                    <td>{{ ingredient.unit_type }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="submit" class="btn btn-primary">Calculate Estimated Revenue</button>
    </form>

    <!-- Display Revenue Results -->
    {% if total_revenue %}
    <h4 class="mt-4">Estimated Revenue: ${{ total_revenue|floatformat:2 }}</h4>
    {% endif %}

    <!-- Section: Reset and Update Inventory -->
    <h3 class="mt-5">Inventory Adjustments</h3>
    <form method="POST" class="mt-3">
        {% csrf_token %}
        <input type="hidden" name="mode" value="edit_inventory">
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Ingredient</th>
                    <th>Current Quantity</th>
                    <th>Unit</th>
                </tr>
            </thead>
            <tbody>
                {% for ingredient in required_ingredients %}
                <tr>
                    <td>{{ ingredient.name }}</td>
                    <td>
                        <input type="number" class="form-control" name="quantity_{{ ingredient.id }}"
                               value="{{ ingredient.current_quantity|floatformat:2 }}" step="0.01">
                    </td>
                    <td>{{ ingredient.unit_type }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="submit" class="btn btn-primary">Save Changes</button>
    </form>
    <form method="POST" class="mt-3">
        {% csrf_token %}
        <input type="hidden" name="mode" value="reset_inventory">
        <button type="submit" class="btn btn-secondary">Reset Inventory</button>
    </form>

    <!-- Success and Error Messages -->
    {% if success %}
    <div class="alert alert-success mt-4">{{ success }}</div>
    {% endif %}

    {% if error %}
    <div class="alert alert-danger mt-4">{{ error }}</div>
    {% endif %}
</div>
{% endblock %}
